#!/bin/bash
# ~/.git-global-hooks/prepare-commit-msg

COMMIT_MSG_FILE=$1
COMMIT_SOURCE=$2
SHA1=$3

if [ -z "$COMMIT_SOURCE" ]; then
    echo "ü§ñ Claude r√©dige le message de commit..."

    DIFF=$(git diff --cached)

    if [ -z "$DIFF" ]; then
        exit 0
    fi

    MSG=$(echo "$DIFF" | claude --model haiku -p "G√©n√®re un message de commit git concis (max 50 chars pour le titre) suivant la norme Angular. Format: type(scope): description. Types: feat, fix, docs, style, refactor, test, chore. Donne UNIQUEMENT le message, sans blabla. Exemple: 'feat(auth): add login validation'")

    sed -i.bak "1s/^/$MSG\n\n/" "$COMMIT_MSG_FILE"
fi
